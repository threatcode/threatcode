#!/bin/bash
#


#. /usr/sbin/tc-elastic-common
#. /etc/nsm/threatcode.conf

# If logrotate script doesn't already exist, create it
#FILE="/etc/logrotate.d/tc-curator-closed-delete"
#if ! [ -f ${FILE} ]; then
#        cat << EOF > ${FILE}
#/var/log/nsm/tc-curator-closed-delete.log {
#    daily
#    rotate 7
#    copytruncate
#    compress
#    missingok
#    notifempty
#}
#EOF
#fi

# Avoid starting multiple instances
APP=closeddelete
lf=/tmp/$APP-pidLockFile
# create empty lock file if none exists
cat /dev/null >> $lf
read lastPID < $lf
# if lastPID is not null and a process with that pid exists , exit
[ ! -z "$lastPID" -a -d /proc/$lastPID ] && exit
echo $$ > $lf

/usr/sbin/tc-curator-closed-delete-delete
